<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gbk" />
<title>创建模块控制器类 - 构建模块 - PHPCMS V9 在线帮助文档</title>
<meta name="keywords" content="创建模块控制器类,创建模块控制器">
<meta name="description" content="　　phpcms v9的控制器就是模块的类文件，位于phpcms/modules/模块/目录下面。类名成就是文件名+.php，例如一个名为mytest的控制器,那么他的命名为mytest.php即可。控制器类默认继承系统的函数库，可以直接使用...">
<style type="text/css">
<!--
*{ padding:0; margin:0}
h5 a, a{color:#000}
h5{font-size:14px; font-weigth:normal }
ul,li{ list-style:none}
a{text-decoration:none;}
a:hover{text-decoration:underline;}
body,html{background: url("statics/images/img/left-bg.png"/*tpa=http://v9.help.phpcms.cn/statics/images/img/left-bg.png*/) repeat-y; font:12px/20px "tahoma,verdana,arial,sans-serif"}
h1{font-size:34px;}h2{font-size:26px; padding:8px 0 16px}h3{font-size:18px; }h4{font-size:16px;}h5{font-size:14px;}h6{font-size:12px;}
.f12{font-size: 12px}.f14{font-size: 14px}.f16{font-size: 16px}.f18{font-size:18px}.f20{font-size:20px}
.lh20{line-height: 20px}.lh22{line-height: 22px}.lh24{line-height: 24px}.lh26{line-height: 26px}.lh28{line-height: 28px}
.fb{ font-weight:bold}.fn{ font-weight:normal}
.bk,.bk3,.bk6,.bk8,.bk10,.bk15,.bk20,.bk30{clear: both;font-size: 1px;height: 0;line-height: 1px}
.bk3{height: 3px;}.bk6{height: 6px}.bk8{height: 8px}.bk10{height: 10px}.bk15{height: 15px}.bk20{height: 20px}.bk30{height: 30px}
.row-2 li{ float:left; width:50%}.row-3 li{ float:left; width:33%}.row-4 li{ float:left; width:25%}.row-5 li{ float:left; width:20%}
.cu,.cu-li li,.cu-span span {cursor: hand;!important;cursor: pointer}
.text-c{text-align: center}.text-l{text-align: left}.text-r{text-align: right}
.lf{float: left}.rt{float: right}.pr{ position:relative}.pa{ position:absolute}

.header {background: url("statics/images/img/logo.png"/*tpa=http://v9.help.phpcms.cn/statics/images/img/logo.png*/) no-repeat 15px center #0065b2;border-bottom: 1px solid #00508d; height:34px; line-height:34px}
.nav{ float:right; padding-right:16px;}
.nav a{ color:#e2e9ea}
.maincol{ overflow:hidden}
.col-left{ float:left; width:163px; padding:15px 0 0 15px; margin-right:10px}
.col-auto{ overflow:hidden;_float:left; zoom:1; padding:15px 10px 0 0;font-size:14px; line-height:30px;}
.sidebar{ margin-bottom:8px}
.sidebar li{ line-height:18px;}
.sidebar li a{color:#0066dd; background: url("statics/images/img/o.png"/*tpa=http://v9.help.phpcms.cn/statics/images/img/o.png*/) no-repeat left center; padding-left:8px}
.letter{ padding:10px 0}
.letter a { display:inline-block; width:26px; height:22px; line-height:21px; background:#fff; border:1px solid #e3e3e3; text-align:center; color:#333; margin-right:5px}
.letter a { background:url("statics/images/img/pages.png"/*tpa=http://v9.help.phpcms.cn/statics/images/img/pages.png*/) no-repeat 0 5px; font-family:Arial, Helvetica, sans-serif}
.letter a:hover { background:#f1f1f1; color:#000; text-decoration:none;}
.letter a.cur{background:#5a85b2; border:1px solid #5a85b2; color:#fff;}

.letNum{background-color: #EFEFEF; padding:3px 8px}
.letNum span{ font-size:12px; font-weight:normal}
.letList{ padding:10px}
.letList dd{ border:1px solid #eee; padding:3px 5px; color: #666; margin-bottom:8px}
.src-code {background-color:#f4f9fe;border:1px solid #e8e8e8;	font-family:'Courier New',Courier,monospace;font-weight:normal;margin:0;overflow:auto;padding:1em}
.separator {background-color:#bed0e4;height:1px;}
hr{border-color:#bed0e4;border-style:solid;height:1px;margin-bottom:10px;margin-top:10px}
blockquote{border:dashed 1px; padding:5px; background :#F2F2F2}
blockquote em{font-style:normal;font-size:12px;}

ol{padding-left:40px}
ol li{list-style-type: decimal; text-indent:-8px}
.content_end a{font-weight:bold}
.clear{clear:both}
.footer{text-align:center;margin:auto}
-->
</style>
<link href="statics/css/prettify.css" tppabs="http://v9.help.phpcms.cn/statics/css/prettify.css" type="text/css" rel="stylesheet" /> 
<script type="text/javascript" src="statics/js/prettify/prettify.js" tppabs="http://v9.help.phpcms.cn/statics/js/prettify/prettify.js"></script>
</head>

<body onload="prettyPrint()">
<div class="header">
<span class="nav"></span>
</div><a name="top"></a>
    <div class="col-left">
     <h5><a href="index.htm" tppabs="http://v9.help.phpcms.cn/">PHPCMS V9帮助中心</a></h5>
        	<h5><a href="index.php-m=content&c=index&a=lists&catid=181&page=1.htm" tppabs="http://v9.help.phpcms.cn/index.php?m=content&c=index&a=lists&catid=181&page=1">二次开发</a></h5>
            <h5><a href="index.php-m=content&c=index&a=lists&catid=187&page=1.htm" tppabs="http://v9.help.phpcms.cn/index.php?m=content&c=index&a=lists&catid=187&page=1">构建模块</a></h5>
                <ul class="sidebar">
                     	<li><a href="index.php-m=content&c=index&a=show&catid=187&id=85.htm" tppabs="http://v9.help.phpcms.cn/index.php?m=content&c=index&a=show&catid=187&id=85" title="开发流程">开发流程</a></li>
        	        	<li><a href="index.php-m=content&c=index&a=show&catid=187&id=86.htm" tppabs="http://v9.help.phpcms.cn/index.php?m=content&c=index&a=show&catid=187&id=86" title="创建模块">创建模块</a></li>
        	        	<li><a href="index.php-m=content&c=index&a=show&catid=187&id=92.htm" tppabs="http://v9.help.phpcms.cn/index.php?m=content&c=index&a=show&catid=187&id=92" title="创建模块控制器类"><b>创建模块控制器类</b></a></li>
        	        	<li><a href="index.php-m=content&c=index&a=show&catid=187&id=93.htm" tppabs="http://v9.help.phpcms.cn/index.php?m=content&c=index&a=show&catid=187&id=93" title="创建数据库模型类">创建数据库模型类</a></li>
        	        </ul>
            </div>
    <div class="col-auto">
    <h2>创建模块控制器类</h2>
     <p>
	在创建模块中我们已经创建好了一个名为&ldquo;test&rdquo;的模块，接下来我们继续为这个模块添加两个控制器类。</p>
<p>
	phpcms v9的控制器就是模块的类文件，位于phpcms/modules/模块/目录下面。类名成就是文件名+.php，例如一个名为mytest的控制器,那么他的命名为mytest.php即可。控制器类默认继承系统的函数库，可以直接使用。控制器类的<strong>类名称与控制器文件名必须相同</strong>。</p>
<p>
	控制器类文件包含两种形式：</p>
<p>
	<strong>1.mytest.php 控制器，前台浏览（不含权限控制）</strong></p>
<blockquote>
	<p>
		&lt;?php<br />
		　　defined(&#39;IN_PHPCMS&#39;) or exit(&#39;No permission resources.&#39;);<br />
		　　class mytest {<br />
		　　 　　function __construct() {<br />
		　　　　}<br />
		　　　　public function init() {<br />
		　　　　　$var = &#39;hello world!&#39;;<br />
		　　　　　echo $myvar;<br />
		&nbsp;　　　　}</p>
	<p>
		　　　　public function mylist() {<br />
		　　　　　$var = &#39;hello world!this is a example!&#39;;<br />
		　　　　　echo $myvar;<br />
		&nbsp;　　　　}<br />
		　　}<br />
		?&gt;</p>
</blockquote>
<p>
	<br />
	这个控制器的url访问方法前面已经介绍过了，<br />
	&nbsp;</p>
<blockquote>
	<p>
		http://www.yourname.com/index.php?m=test&amp;c=mytest<br />
		http://www.yourname.com/index.php?m=test&amp;c=mytest&amp;a=mylist</p>
</blockquote>
<p>
	没有填写 &ldquo;a&rdquo; 的情况下，默认调用init方法<br />
	<br />
	<strong>2.mytest_admin.php 控制器，后台管理(含权限控制)</strong><br />
	&nbsp;<br />
	后台控制控制器需要<strong>加载admin模块下的admin类</strong>，并继承该类。需要注意的是因为你添加的控制器类继承了其他的类，你要小心你控制器的方法名不要和该类中的方法名一样了，否则会造成影响，具体请查看admin类中有哪些方法。</p>
<blockquote>
	<p>
		&lt;?php<br />
		defined(&#39;IN_PHPCMS&#39;) or exit(&#39;No permission resources.&#39;);<br />
		pc_base::load_app_class(&#39;admin&#39;,&#39;admin&#39;,0);<br />
		class mytest_admin extends admin {<br />
		　　public function __construct() {<br />
		　　}<br />
		　　public function init() {<br />
		　　　　$myvar = &#39;oh,i am phpcmser&#39;;<br />
		　　　　echo $myvar;<br />
		　　}<br />
		}<br />
		?&gt;</p>
</blockquote>
<p>
	<br />
	<strong>在控制器中增加模板调用</strong></p>
<p>
	phpcms 可以实现完全的模板与程序分离，所以在我们的控制器程序中要加载模板，才可以更友好的显示出来。</p>
<p>
	<strong>1.加载前台模板</strong></p>
<p>
	前台模板文件在phpcms\templates\default\模块名称 目录中，本示例也就在phpcms\templates\default\test中</p>
<p>
	加载模板方法如下:</p>
<blockquote>
	<p>
		　include template(&#39;test&#39;, &#39;mytest&#39;, &#39;default&#39;);</p>
</blockquote>
<p>
	其中<span style="color: #ff0000"> test</span>为模块名称<span style="color: #ff0000"> mytest&nbsp;</span>为模板目录下模板名称,<span style="color: #ff0000">default</span>为风格名称，默认不填为defalut</p>
<p>
	在上面例子中如果要给mytest.php中init方法加载一个mytest的模板，如下</p>
<p>
	&nbsp;</p>
<blockquote>
	<p>
		　　public function init() {<br />
		　　　　　$var = &#39;hello world!&#39;;<br />
		　　　　　include template(&#39;test&#39;, &#39;mytest&#39;, &#39;default&#39;);<br />
		&nbsp;　　}</p>
</blockquote>
<p>
	<br />
	这样我们通过url访问该方法的时候也就加载了对应的模板。</p>
<p>
	<strong>2.加载后台模板</strong></p>
<p>
	后台模板文件在phpcms\modules\模块名称\templates 目录中，本示例也就在phpcms\modules\test\templates 中</p>
<p>
	加载模板方法如下：</p>
<blockquote>
	<p>
		include $this-&gt;admin_tpl(&#39;mytest_admin_list&#39;);</p>
</blockquote>
<p>
	<br />
	其中mytest_admin_list为phpcms\modules\test\templates中mytest_admin_list.tpl.php，<span style="color: #ff0000"><strong>注意：</strong></span>此处模板必须以.tpl.php 作为后缀</p>
<p>
	在上面例子中如果要给mytest_admin.php中init方法加载一个mytest_admin_list的模板，如下<br />
	&nbsp;</p>
<blockquote>
	<p>
		　public function init() {<br />
		　　　　$myvar = &#39;oh,i am phpcmser&#39;;<br />
		　　　　include $this-&gt;admin_tpl(&#39;mytest_admin_list&#39;);<br />
		　　}<br />
		&nbsp;</p>
</blockquote>
     <div class="content_end"><a href="#top">回到顶部↑</a> <a href="index.php-m=content&c=index&a=lists&catid=181&page=1.htm" tppabs="http://v9.help.phpcms.cn/index.php?m=content&c=index&a=lists&catid=181&page=1">返回到二次开发</a>
    </div>
    </div>
</div>
<div class="clear"></div>
<div class="footer">PHPCMS 帮助文档 &copy; 2010 盛大网络发展有限公司</div>
</body>
</html>